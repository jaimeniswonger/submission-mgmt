/*! backbone.marionette.phoenix 1.0.0-SNAPSHOT 2013-05-24 */
(function(t,e){"use strict";if("object"==typeof exports){var i=require("underscore"),r=require("marionette"),o=require("backbone");module.exports=e(i,r,o)}else"function"==typeof define&&define.amd&&define(["underscore","marionette","backbone"],e)})(this,function(t,e,i){i.Marionette.Renderer.render=function(t,i){var o="function"==typeof t?t:e.TemplateCache.get(t),n=o(i);return r.secure&&(n=r.secure.secureHtml(n)),n};var r=function(t,e,r){var o={};e.Phoenix=o,o.$=e.$,o.extend=e.extend;var n=function(t){this._configure(t||{}),this.initialize.apply(this,arguments),r(this).bindAll("hasRole","hasAllRoles","hasNoRoles")},s=["secureTag"];return r.extend(n.prototype,{secureTag:"data-secure",secureActionTag:"data-secure-action",principal:void 0,roles:void 0,isAuthenticate:!1,routers:[],initialize:function(){this.principal="jaime",this.roles=["ROLE1"],this.isAuthenticate=!0},authenticate:function(t){if(void 0===t)throw Error("Authentication failed");this.principal=t.principal,this.roles=t.roles,this.isAuthenticate=!0,this.refresh()},authorize:function(t){if(!this.isAuthenticate)return!1;var e=t.match(/(has(All|Any)?Role(s)?)/g),i=t.split("(")[1],r=i.match(/[A-Za-z0-9]+/g),o=this[e];return o(r)},invalidate:function(){this.roles=this.principal=void 0,this.isAuthenticate=!1,this.refresh()},refresh:function(){r.each(this.routers,function(t){t._bindRoutes()})},remove:function(t){$(t).remove()},disable:function(t){$(t).attr("disabled","disabled")},secureHtml:function(t){var e=$(t);return r.each(e.find("[data-secure]"),function(t){var e=$(t),i=e.attr(this.secureTag),o=i.split("(")[0],n=i.split("(")[1].replace(/\[|\]|\)|\'/gi,"").split(","),s=e.attr(this.secureActionTag);r.isFunction(this[o])&&!this[o].apply(this,n)&&(s||(s="remove"),this[s].apply(this,$(t)))},this),e},cleanDom:function(){this.secureHtml($("*"))},_configure:function(t){this.options&&(t=r.extend({},this.options,t));for(var e=0,i=s.length;i>e;e++){var o=s[e];t[o]&&(this[o]=t[o])}this.options=t},hasRole:function(t){var e=r.intersection(this._getRolesAsArray(this.roles),this._getRolesAsArray(t));return e.length>0?!0:!1},hasAllRoles:function(t){var e=r.intersection(this._getRolesAsArray(this.roles),this._getRolesAsArray(t));return e.length===_roles.length?!0:!1},hasNoRoles:function(t){var e=r.intersection(this._getRolesAsArray(this.roles),this._getRolesAsArray(t));return 0===e.length?!0:!1},_getRolesAsArray:function(t){var e;return e=r.isFunction(t)?t():t,r.isArray(e)||(e=[e]),e}}),o.secure=new n,o.AppRouter=e.AppRouter.extend({constructor:function(){var t=Array.prototype.slice.apply(arguments);e.AppRouter.prototype.constructor.apply(this,t)},processAppRoutes:function(t,e){r.each(e,function(e,i){var o=e[0],n=e.length>1?e[1]:void 0;o=n?this.authorize(n)?o:"notAuthorized":o;var s=t[o];if(!s)throw Error("Method '"+o+"' was not found on the controller");this.route(i,o,r.bind(s,t))},this)},authorize:function(t){return o.secure.authorize(t)}}),o.Controller=e.Controller.extend({constructor:function(){var t=Array.prototype.slice.apply(arguments);e.Controller.prototype.constructor.apply(this,t)},notAuthorized:function(){window.location="/401.html"}}),o.Application=e.Application.extend({}),o.Layout=e.Layout.extend({}),o.ItemView=e.ItemView.extend({}),o.CollectionView=e.CollectionView.extend({}),o.CompositeView=e.CompositeView.extend({}),o.Model=i.Model.extend({}),o}(this,e,t);return e.Phoenix});